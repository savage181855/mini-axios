{"version":3,"file":"index.js","sources":["../../../src/libs/adapter.ts","../../../src/libs/dispatchRequest.ts","../../../src/libs/interceptor.ts","../../../src/libs/axios.ts","../../../src/libs/defaultConfig.ts","../../../src/libs/utils.ts","../../../src/libs/index.ts"],"sourcesContent":["import {\n  AxiosRequestConfig,\n  AxiosRequestData,\n  NoBodyMethods,\n  BodyMethods,\n  AxiosResponse\n} from \"./types\";\n\nexport function adapter(config: AxiosRequestConfig):AxiosResponse<any> {\n  return new Promise((resovle, reject) => {\n    wx.request({\n      ...(config as any),\n      success(res) {\n        resovle(res);\n      },\n      fail(err) {\n        reject(err);\n      },\n    });\n  });\n}\n","import { adapter } from \"./adapter\";\n\nimport { AxiosRequestConfig, AxiosResponse } from \"./types\";\n\nexport function dispatchRequest<T extends ArrayBuffer>(\n  config: AxiosRequestConfig\n): AxiosResponse<T> {\n  // 在这里进行，baseUrl拼接，转换数据的操作等等。\n\n  config.url = config.baseURL ? config.baseURL + config.url : config.url;\n  return adapter(config);\n}\n","import _ from \"lodash\";\r\n\r\nimport { HandlerItem,HandlersType, Callback } from \"./types\";\r\n\r\nexport class Interceptor {\r\n  handlers: HandlersType = [];\r\n\r\n  constructor() {}\r\n\r\n  use(fulfilled: Callback, rejected: Callback) {\r\n    this.handlers.push({\r\n      fulfilled,\r\n      rejected,\r\n    });\r\n\r\n    const index = this.handlers.length - 1;\r\n    return index;\r\n  }\r\n\r\n  eject(index: number) {\r\n    if (this.handlers[index]) this.handlers[index] = null;\r\n  }\r\n\r\n  forEach(fn: (v: HandlerItem, i: number) => any) {\r\n    _.forEach(this.handlers, function (v, i) {\r\n      if (v) fn(v, i);\r\n    });\r\n  }\r\n}\r\n","import _ from \"lodash\";\r\nimport { dataTypes } from \"@savage181855/data-types\";\r\n\r\nimport { dispatchRequest } from \"./dispatchRequest\";\r\nimport { Interceptor } from \"./interceptor\";\r\n\r\nimport {\r\n  AxiosRequestConfig,\r\n  AxiosRequestData,\r\n  NoBodyMethods,\r\n  BodyMethods,\r\n  AxiosPromise,\r\n} from \"./types\";\r\n\r\nexport class Axios {\r\n  defaults = {} as AxiosRequestConfig;\r\n  interceptors = {\r\n    request: new Interceptor(),\r\n    response: new Interceptor(),\r\n  };\r\n\r\n  constructor(defaults?: AxiosRequestConfig) {\r\n    this.defaults = defaults || {};\r\n\r\n    const methods = [\r\n      \"get\",\r\n      \"delete\",\r\n      \"AxiosRequestConfig\",\r\n      \"head\",\r\n      \"connect\",\r\n    ] as const;\r\n\r\n    for (let k of methods) {\r\n      this[k] = (url: string, config: AxiosRequestConfig) => {\r\n        return this.request(\r\n          _.merge(config, {\r\n            method: k,\r\n            url,\r\n            data: (config || {}).data,\r\n          })\r\n        );\r\n      };\r\n    }\r\n\r\n    const bodyMethods = [\"post\", \"put\"] as const;\r\n    for (let k of bodyMethods) {\r\n      this[k] = (\r\n        url: string,\r\n        data: AxiosRequestData,\r\n        config: AxiosRequestConfig\r\n      ) => {\r\n        return this.request(\r\n          _.merge(config, {\r\n            method: k,\r\n            url,\r\n            data,\r\n          })\r\n        );\r\n      };\r\n    }\r\n  }\r\n\r\n  request(config: AxiosRequestConfig) {\r\n    if (dataTypes.isString(config)) {\r\n      config = _.merge({ url: arguments[0] }, arguments[1]);\r\n    }\r\n\r\n    config = _.merge(this.defaults, config);\r\n\r\n    let promise = Promise.resolve(config);\r\n    let chain = [];\r\n\r\n    this.interceptors.request.forEach(function (interceptors) {\r\n      if (interceptors) {\r\n        chain.push(interceptors?.fulfilled, interceptors?.rejected);\r\n      }\r\n    });\r\n    chain.push(dispatchRequest, null);\r\n    this.interceptors.response.forEach(function (interceptors) {\r\n      chain.push(interceptors?.fulfilled, interceptors?.rejected);\r\n    });\r\n\r\n    while (chain.length) {\r\n      promise = promise.then(chain.shift(), chain.shift());\r\n    }\r\n    return promise as AxiosPromise;\r\n  }\r\n\r\n  get: NoBodyMethods = () => {};\r\n  delete: NoBodyMethods = () => {};\r\n  head: NoBodyMethods = () => {};\r\n  AxiosRequestConfig: NoBodyMethods = () => {};\r\n  connect: NoBodyMethods = () => {};\r\n\r\n  post: BodyMethods = () => {};\r\n  put: BodyMethods = () => {};\r\n\r\n  all<T>(p: Promise<T>[]) {\r\n    return Promise.all(p);\r\n  }\r\n\r\n  race<T>(p: Promise<T>[]) {\r\n    return Promise.race(p);\r\n  }\r\n}\r\n","import {AxiosRequestConfig} from './types'\n\nexport const defaultConfig: AxiosRequestConfig = {\n\turl: '',\n    data: {},\n    header: {\n        'Content-Type': 'application/x-www-form-urlencoded;charset=utf-8'\n    },\n    method: 'GET',\n    dataType: 'json',\n    responseType: 'text'\n}  ","import { dataTypes } from \"@savage181855/data-types\";\n\nimport _ from \"lodash\";\n\nexport function extend(\n  target: WechatMiniprogram.IAnyObject,\n  source: WechatMiniprogram.IAnyObject,\n  thisArg: any\n) {\n  _.forEach(source, function (val, key) {\n    if (dataTypes.isObject(thisArg) && dataTypes.isFunction(val)) {\n      target[key] = (val as Function).bind(thisArg);\n    } else {\n      target[key] = val;\n    }\n  });\n  return target;\n}\n","import _ from \"lodash\";\nimport { Axios } from \"./axios\";\n\nimport { defaultConfig } from \"./defaultConfig\";\n\nimport { extend } from \"./utils\";\n\n\nimport {\n  AxiosRequestConfig,\n  AxiosInstance,\n} from \"./types\";\n\nexport * from './types'\n\nfunction getInstance(config: AxiosRequestConfig) {\n  const axios = new Axios(config);\n  const instance = axios.request.bind(axios) as AxiosInstance<Axios>;\n\n  extend(instance, Axios.prototype, axios);\n\n  (instance as any).create = (config: AxiosRequestConfig) => {\n    getInstance(_.merge(defaultConfig, config));\n  };\n  return instance;\n}\n\nconst instance = getInstance(defaultConfig);\n\nexport { instance as axios };\n"],"names":["_","dataTypes"],"mappings":"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"}