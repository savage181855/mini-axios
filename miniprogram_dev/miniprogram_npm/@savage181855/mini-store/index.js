function t(t,n){var o={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.indexOf(e)<0&&(o[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(e=Object.getOwnPropertySymbols(t);i<e.length;i++)n.indexOf(e[i])<0&&Object.prototype.propertyIsEnumerable.call(t,e[i])&&(o[e[i]]=t[e[i]])}return o}function n(t,o,e){if(t===o)return!0;if("object"!=typeof t||null===t||"object"!=typeof o||null===o)return!1;if(Object.keys(t).length!==Object.keys(o).length)return!1;for(var i=0,s=Object.keys(t);i<s.length;i++){var l=s[i];if("shallow"===e&&t[l]!==o[l])return!1;if("deep"===e){var r=n(t[l],o[l],"deep");if(!r)return r}}return!0}function o(t,o){return n(t,o,"deep")}var e="[object Object]",i="[object Array]";function s(t,n){var o=function(t){return Object.prototype.toString.call(t)}(t);if(o===e){var l={};return Object.keys(t).forEach((function(o){l[o]="shallow"===n?t[o]:s(t[o],"deep")})),l}return o===i?t.map((function(t){return"shallow"===n?t:s(t,"deep")})):t}var l=function(t){return s(t,"deep")},r=function(t,n){return!o(t,n)},c=function(t){return null!==t&&"object"==typeof t},a=o;const u=function(){setTimeout((()=>{function n(t){console.error(`必须在 app.js|ts 文件 调用 ${t}()，参考：https://www.npmjs.com/package/@savage181855/mini-store`)}t.isProxyPage||n("proxyPage"),t.isProxyComponent||n("proxyComponent"),t.isProxyApp||n("proxyApp")}));const t={isProxyPage:!1,isProxyComponent:!1,isProxyApp:!1};return function(n){t[n]=!0}}();function d(){var t;const n=getCurrentPages();return(null===(t=n[n.length-1])||void 0===t?void 0:t.route)||""}class f extends Map{}function h(){const t=d();if(!t)return;const n=f.stores[t];n&&n.forEach((t=>{const{mapState:n,instance:o,store:e,watch:i,mapComputed:s}=t,r=[];n&&r.push(...n),s&&r.push(...s);const c={};null==r||r.forEach((t=>{a(o.data[t],e[t])||(c[t]=l(e[t]))})),"{}"!==JSON.stringify(c)&&o.setData(c),i&&Object.keys(i).forEach((t=>{if(!a(o.watchValue[t],e[t])){const n=l(e[t]);i[t]=i[t].bind(o),i[t](o.watchValue[t],n),o.watchValue[t]=n}}))}))}function p(t){const n=d();f.stores[n]=f.stores[n].filter((n=>n.instance!==t))}function v(n,o){null==o||o.forEach((o=>{const{useStoreRef:e}=o,i=t(o,["useStoreRef"]);e(n,i)}))}function m(){u("isProxyApp");const n=App;App=function(o){const e=t(o,["stores"]),i=Object.assign(Object.assign({},e),{onLaunch(t){var n;this.type="app";const{stores:e}=o;v(this,e),null===(n=null==o?void 0:o.onLaunch)||void 0===n||n.call(this,t)}});return n(i)}}function y(n={}){u("isProxyPage");const o=Page;Page=function(e){const i=t(e,["stores"]);let s=Object.assign(Object.assign(Object.assign({},n),i),{onLoad(t){var o,i;const{stores:s}=e;v(this,s),null===(o=null==n?void 0:n.onLoad)||void 0===o||o.call(this,t),null===(i=null==e?void 0:e.onLoad)||void 0===i||i.call(this,t)},onShow(){var t,o;h(),null===(t=null==n?void 0:n.onShow)||void 0===t||t.call(this),null===(o=null==e?void 0:e.onShow)||void 0===o||o.call(this)},onUnload(){var t,o;!function(){const t=d();f.stores[t]=[]}(),null===(t=null==n?void 0:n.onUnload)||void 0===t||t.call(this),null===(o=null==e?void 0:e.onUnload)||void 0===o||o.call(this)}});return s=b(["onReady","onHide","onPullDownRefresh","onReachBottom","onPageScroll","onResize","onTabItemTap"],s,n,e),o(s)}}function g(n={}){u("isProxyComponent");const o=Component;Component=function(e){const i=t(e,["stores"]);let s=Object.assign(Object.assign(Object.assign({},n),i),{attached(){var t,o;this.route=d();const{stores:i}=e;v(this,i),h(),null===(t=null==e?void 0:e.attached)||void 0===t||t.call(this),null===(o=null==n?void 0:n.attached)||void 0===o||o.call(this)},detached(){var t,o;p(this),null===(t=null==e?void 0:e.detached)||void 0===t||t.call(this),null===(o=null==n?void 0:n.detached)||void 0===o||o.call(this)},lifetimes:{attached(){var t,o,i,s;this.route=d();const{stores:l}=e;v(this,l),h(),null===(o=null===(t=null==e?void 0:e.lifetimes)||void 0===t?void 0:t.attached)||void 0===o||o.call(this),null===(s=null===(i=null==n?void 0:n.lifetimes)||void 0===i?void 0:i.attached)||void 0===s||s.call(this)},detached(){var t,o,i,s;p(this),null===(o=null===(t=null==e?void 0:e.lifetimes)||void 0===t?void 0:t.detached)||void 0===o||o.call(this),null===(s=null===(i=null==n?void 0:n.lifetimes)||void 0===i?void 0:i.detached)||void 0===s||s.call(this)}}});return s=b(["created","ready","moved","error","lifetimes.created","lifetimes.ready","lifetimes.moved","lifetimes.error","pageLifetimes.show","pageLifetimes.hide","pageLifetimes.resize"],s,n,e),o(s)}}function b(t,n,o,e){const i=l(n);return t.forEach((t=>{var n,s;const l=t.split("."),r=l.length,c=l[0];if(1===r)i[c]=function(){var t,n;null===(t=null==o?void 0:o[c])||void 0===t||t.call(this,...Array.from(arguments)),null===(n=null==e?void 0:e[c])||void 0===n||n.call(this,...Array.from(arguments))};else{const t=l[1];((null===(n=null==o?void 0:o[c])||void 0===n?void 0:n[t])||(null===(s=null==e?void 0:e[c])||void 0===s?void 0:s[t]))&&(i[c][t]=function(){var n,i,s,l;null===(i=null===(n=null==o?void 0:o[c])||void 0===n?void 0:n[t])||void 0===i||i.call(this,...Array.from(arguments)),null===(l=null===(s=null==e?void 0:e[c])||void 0===s?void 0:s[t])||void 0===l||l.call(this,...Array.from(arguments))})}})),i}function j(t){const n=new f,o=new Proxy(t,{get(t,o,e){const i=Reflect.get(t,o,e);return f.stack.length>0&&(n.get(o)||n.set(o,new Set),f.stack.forEach((t=>{var e;null===(e=n.get(o))||void 0===e||e.add(t)}))),i},set(t,o,e,i){var s;const c=l(t[o]),a=Reflect.set(t,o,e,i);return r(c,e)&&(null===(s=n.get(o))||void 0===s||s.forEach((t=>t(c,e)))),h(),a}});for(let t in o){const n=o[t];c(n)&&(o[t]=j(o[t]))}return o}function O(t){const n=Object.assign(Object.assign(Object.assign({},t.state),t.actions),t.computed),o=j(n);return function(t,n){for(let o in t)"function"==typeof t[o]&&(t[o]=t[o].bind(n,n))}(n,o),function(t,n){t.patch=function(t){if("object"==typeof t)for(let o in t)n[o]=t[o];"function"==typeof t&&t(n)}}(n,o),function(t,n){if(t)for(let o in t)t[o]=t[o].bind(n,n),f.stack.push((()=>n[o]=t[o]())),n[o]=t[o](),f.stack.pop()}(t.computed,o),o}function w(t){const n=t.state,o=t.computed,e=t.actions,i=O(t);return function(t,s){if(t[s.storeKey]=i,"app"===t.type)return;const r=s,c=Object.keys(n);if(r.mapState&&r.mapState.forEach((n=>{c.includes(n)||console.error(`msg: mapState "${n}" not in ${r.storeKey};\n\ninfo: filePath: ${t.is};`)})),r.watch){const n={};Object.keys(r.watch).forEach((o=>{c.includes(o)?n[o]=l(i[o]):console.error(`msg: watch "${o}" not in ${r.storeKey};\n\ninfo: filePath: ${t.is};`)})),t.watchValue=Object.assign(Object.assign({},t.watchValue),n)}if(r.mapComputed){const n=Object.keys(o);r.mapComputed.forEach((o=>{n.includes(o)||console.error(`msg: mapComputed "${o}" not in ${r.storeKey};\n\ninfo: filePath: ${t.is};`)}))}if(r.mapActions){const n=Object.keys(e);r.mapActions.forEach((o=>{n.includes(o)?t[o]=i[o]:console.error(`msg: mapActions "${o}" not in ${r.storeKey};\n\ninfo: filePath: ${t.is};`)}))}const a=t.route;f.stores[a]=f.stores[a]||[];f.stores[a].some((n=>n.instance===t&&n.store===i))||f.stores[a].push(Object.assign(Object.assign({},r),{instance:t,store:i}))}}f.stores={},f.stack=[];export{w as defineStore,m as proxyApp,g as proxyComponent,y as proxyPage};
//# sourceMappingURL=index.js.map
