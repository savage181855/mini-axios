{"version":3,"file":"index.js","sources":["../node_modules/@savage181855/utils/dist/index.js","../src/libs/tips.ts","../src/libs/utils.ts","../src/libs/dep.ts","../src/libs/proxyFunc.ts","../src/libs/createStore.ts","../src/libs/defineStore.ts"],"sourcesContent":["'use strict';\n\n// a[3].b -> a.3.b -> [a, 3, b]\r\n/** lodash get方法 */\r\nfunction getType(o) {\r\n    return Object.prototype.toString.call(o);\r\n}\r\nfunction get(data, path) {\r\n    var paths = path\r\n        .replace(/\\[(\\w+)\\]/g, \".$1\")\r\n        .replace(/\\[\"(\\w+)\"\\]/g, \".$1\")\r\n        .replace(/\\['(\\w+)'\\]/g, \".$1\")\r\n        .split(\".\");\r\n    return paths.reduce(function (x, y) { return x === null || x === void 0 ? void 0 : x[y]; }, data);\r\n}\r\nfunction compare(o1, o2, type) {\r\n    if (o1 === o2)\r\n        return true;\r\n    // 如果基本类型不相等或者不是引用类型，并且不是对象就不用执行了\r\n    if (typeof o1 !== \"object\" ||\r\n        o1 === null ||\r\n        typeof o2 !== \"object\" ||\r\n        o2 === null) {\r\n        return false;\r\n    }\r\n    var len1 = Object.keys(o1).length;\r\n    var len2 = Object.keys(o2).length;\r\n    if (len1 !== len2)\r\n        return false;\r\n    for (var _i = 0, _a = Object.keys(o1); _i < _a.length; _i++) {\r\n        var key = _a[_i];\r\n        if (type === \"shallow\") {\r\n            if (o1[key] !== o2[key])\r\n                return false;\r\n        }\r\n        if (type === \"deep\") {\r\n            var result = compare(o1[key], o2[key], \"deep\");\r\n            if (!result)\r\n                return result;\r\n        }\r\n    }\r\n    return true;\r\n}\r\n/** 对象浅比较，只比较第一层数据 */\r\nfunction isSameShallow(o1, o2) {\r\n    return compare(o1, o2, \"shallow\");\r\n}\r\n/** 对象深比较，比较所有层数据， 深比较主要的点在于，Object或Array实例的每一个属性，基本类型或者特殊构造器类型是否相同 */\r\nfunction isSameDeep(o1, o2) {\r\n    return compare(o1, o2, \"deep\");\r\n}\r\nvar dataType = {\r\n    object: \"[object Object]\",\r\n    array: \"[object Array]\",\r\n};\r\nfunction clone(o, type) {\r\n    var objType = getType(o);\r\n    if (objType === dataType.object) {\r\n        var obj_1 = {};\r\n        Object.keys(o).forEach(function (k) {\r\n            obj_1[k] =\r\n                type === \"shallow\"\r\n                    ? o[k]\r\n                    : clone(o[k], \"deep\");\r\n        });\r\n        return obj_1;\r\n    }\r\n    if (objType === dataType.array) {\r\n        return o.map(function (item) {\r\n            return type === \"shallow\" ? item : clone(item, \"deep\");\r\n        });\r\n    }\r\n    return o;\r\n}\r\n/** 浅拷贝，只拷贝第一层数据 */\r\nfunction shallowClone(obj) {\r\n    return clone(obj, \"shallow\");\r\n}\r\n/** 深克隆，深克隆主要的点在于，复制Object或Array实例的每一个属性，基本类型和特殊构造器类型*/\r\nfunction deepClone(obj) {\r\n    return clone(obj, \"deep\");\r\n}\r\nfunction isObject(value) {\r\n    return value !== null && typeof value === \"object\";\r\n}\r\n/** 判断值，使用深比较 */\r\nfunction hasChanged(value, oldValue) {\r\n    return !isSameDeep(value, oldValue);\r\n}\r\n/** 单例模式 */\r\nfunction getSingle(fn) {\r\n    var res;\r\n    return function () {\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        return res || (res = fn.apply(this, args));\r\n    };\r\n}\n\nvar EventCenter = {\r\n    subscribeList: {},\r\n    // 储存已发布未订阅的消息\r\n    pubAndNoSub: {},\r\n    subscribe: function (name, fn) {\r\n        var _a;\r\n        if (this.pubAndNoSub[name]) {\r\n            fn(this.pubAndNoSub[name]);\r\n            Reflect.deleteProperty(this.pubAndNoSub, name);\r\n        }\r\n        ((_a = this.subscribeList[name]) === null || _a === void 0 ? void 0 : _a.push(fn)) || (this.subscribeList[name] = [fn]);\r\n    },\r\n    publish: function (name, value) {\r\n        var fns = this.subscribeList[name];\r\n        if (!fns || fns.length === 0) {\r\n            this.pubAndNoSub[name] = value;\r\n        }\r\n        else {\r\n            fns.forEach(function (fn) { return fn(value); });\r\n        }\r\n    },\r\n    remove: function (name, fn) {\r\n        var _this = this;\r\n        var fns = this.subscribeList[name];\r\n        if (!fns || fns.length === 0)\r\n            return;\r\n        if (fn) {\r\n            fns.forEach(function (_fn, index) {\r\n                if (_fn === fn) {\r\n                    _this.subscribeList[name].splice(index, 1);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.subscribeList[name] = [];\r\n        }\r\n    },\r\n};\r\n/** 给对象添加发布订阅的事件中心 */\r\nfunction installEventCenter(obj) {\r\n    var cloneObj = deepClone(EventCenter);\r\n    for (var k in EventCenter)\r\n        obj[k] = cloneObj[k];\r\n    return obj;\r\n}\n\n/** 解析省市区列表数据，提供给uView组件使用 */\r\nfunction parseAreaListData(areaData) {\r\n    var temp = [];\r\n    var province_list = areaData.province_list, city_list = areaData.city_list, county_list = areaData.county_list;\r\n    for (var provinceCode in province_list) {\r\n        var provinceId = provinceCode.substr(0, 2);\r\n        var provinceItem = {};\r\n        provinceItem.value = province_list[provinceCode];\r\n        provinceItem.label = province_list[provinceCode];\r\n        for (var cityCode in city_list) {\r\n            var cityId = cityCode.substr(0, 4);\r\n            var cityItem = {};\r\n            if (cityId.includes(provinceId)) {\r\n                cityItem.value = city_list[cityCode];\r\n                cityItem.label = city_list[cityCode];\r\n                for (var countyCode in county_list) {\r\n                    var countyItem = {};\r\n                    if (countyCode.includes(cityId)) {\r\n                        countyItem.value = county_list[countyCode];\r\n                        countyItem.label = county_list[countyCode];\r\n                        cityItem.children.push(countyItem);\r\n                    }\r\n                }\r\n                provinceItem.children.push(cityItem);\r\n            }\r\n        }\r\n        temp.push(provinceItem);\r\n    }\r\n    return temp;\r\n}\n\n/**\r\n * @description 防抖，防止抖动，将一段时间内的多次触发控制为一次触发\r\n * @param fn 回调函数\r\n * @param delay 延迟时间\r\n * @param immediate 是否立即调用\r\n */\r\nfunction debounce(fn, delay, immediate) {\r\n    if (delay === void 0) { delay = 1500; }\r\n    if (immediate === void 0) { immediate = true; }\r\n    var timer;\r\n    return function () {\r\n        var _this = this;\r\n        var args = [];\r\n        for (var _i = 0; _i < arguments.length; _i++) {\r\n            args[_i] = arguments[_i];\r\n        }\r\n        if (timer)\r\n            clearTimeout(timer);\r\n        if (immediate) {\r\n            if (!timer)\r\n                fn.apply(this, args);\r\n            timer = setTimeout(function () { return (timer = null); }, delay);\r\n        }\r\n        else {\r\n            timer = setTimeout(function () { return fn.apply(_this, args); }, delay);\r\n        }\r\n    };\r\n}\r\n/**\r\n * @description 节流，将一段时间内的多次触发控制为一定时间间隔内触发一次\r\n * @param fn 回调函数\r\n * @param delay 延迟时间\r\n * @param immediate 是否立即调用\r\n */\r\nfunction throttle(fn, delay, type) {\r\n    if (delay === void 0) { delay = 1500; }\r\n    if (type === void 0) { type = \"timestamp\"; }\r\n    if (type === \"timestamp\") {\r\n        var prevTime_1 = 0;\r\n        return function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            var currentTime = Date.now();\r\n            if (currentTime - prevTime_1 > delay) {\r\n                fn.apply(this, args);\r\n                prevTime_1 = currentTime;\r\n            }\r\n        };\r\n    }\r\n    else {\r\n        var timer_1;\r\n        return function () {\r\n            var _this = this;\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            if (!timer_1) {\r\n                timer_1 = setTimeout(function () {\r\n                    fn.apply(_this, args);\r\n                    timer_1 = null;\r\n                }, delay);\r\n            }\r\n        };\r\n    }\r\n}\n\nexports.clone = clone;\nexports.compare = compare;\nexports.debounce = debounce;\nexports.deepClone = deepClone;\nexports.get = get;\nexports.getSingle = getSingle;\nexports.getType = getType;\nexports.hasChanged = hasChanged;\nexports.installEventCenter = installEventCenter;\nexports.isObject = isObject;\nexports.isSameDeep = isSameDeep;\nexports.isSameShallow = isSameShallow;\nexports.parseAreaListData = parseAreaListData;\nexports.shallowClone = shallowClone;\nexports.throttle = throttle;\n","export const setTip = (function () {\r\n  setTimeout(() => {\r\n    function tip(text: string) {\r\n      console.error(\r\n        `必须在 app.js|ts 文件 调用 ${text}()，参考：https://www.npmjs.com/package/@savage181855/mini-store`\r\n      );\r\n    }\r\n    if (!types.isProxyPage) tip(\"proxyPage\");\r\n    if (!types.isProxyComponent) tip(\"proxyComponent\");\r\n    if (!types.isProxyApp) tip(\"proxyApp\");\r\n  });\r\n\r\n\r\n  const types = {\r\n    isProxyPage: false,\r\n    isProxyComponent: false,\r\n    isProxyApp: false,\r\n  }\r\n\r\n  return function (text: keyof typeof types) {\r\n    types[text] = true;\r\n  };\r\n})();\r\n\r\n","export function getCurrentPagePath() {\r\n  const pages = getCurrentPages();\r\n  return pages[pages.length - 1]?.route || '';\r\n}","import type {\r\n  Callback,\r\n  DepStateWithWatch,\r\n  DepStack,\r\n  ComponentInstance,\r\n} from \"./types\";\r\n\r\nimport { deepClone, isSameDeep } from \"@savage181855/utils\";\r\n\r\nimport { getCurrentPagePath } from \"./utils\";\r\nexport class Dep extends Map<any, Set<Callback>> {\r\n  static stores: Record<string, DepStateWithWatch> = {};\r\n  static stack: DepStack = [];\r\n}\r\n\r\n// not pure function\r\nexport function updateStoreState() {\r\n  const path = getCurrentPagePath();\r\n  if (!path) return;\r\n\r\n  const stores = Dep.stores[path];\r\n  if (!stores) return;\r\n\r\n  stores.forEach((s) => {\r\n    const { mapState, instance, store, watch, mapComputed } = s;\r\n\r\n    const stateArr = [];\r\n\r\n    if (mapState) stateArr.push(...mapState);\r\n    if (mapComputed) stateArr.push(...mapComputed);\r\n    const data: Record<string, any> = {};\r\n    stateArr?.forEach((key) => {\r\n      if (\r\n        !isSameDeep(\r\n          instance.data[key as keyof typeof instance.data] as any,\r\n          store[key]\r\n        )\r\n      ) {\r\n        data[key] = deepClone(store[key]);\r\n      }\r\n    });\r\n    if (JSON.stringify(data) !== \"{}\") instance.setData(data);\r\n\r\n    if (watch) {\r\n      Object.keys(watch).forEach((key) => {\r\n        if (!isSameDeep(instance.watchValue[key], store[key])) {\r\n          const newValue = deepClone(store[key]);\r\n          watch[key] = watch[key].bind(instance);\r\n          watch[key](instance.watchValue[key], newValue);\r\n          instance.watchValue[key] = newValue;\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nexport function clearStoreDep() {\r\n  const path = getCurrentPagePath();\r\n  Dep.stores[path] = [];\r\n}\r\n\r\n// not pure function\r\nexport function removeStoreDep(instance: ComponentInstance) {\r\n  const path = getCurrentPagePath();\r\n  Dep.stores[path] = Dep.stores[path].filter(\r\n    (item) => item.instance !== instance\r\n  );\r\n}\r\n","import { deepClone } from \"@savage181855/utils\";\r\n\r\nimport type {\r\n  BaseStoreOptions,\r\n  AppOptions,\r\n  AppNewOptions,\r\n  PageOptions,\r\n  PageNewOptions,\r\n  ComponentOptions,\r\n  ComponentNewOptions,\r\n  StoreOptions,\r\n  ComponentInstance,\r\n  Instance,\r\n} from \"./types\";\r\n\r\nimport { setTip } from \"./tips\";\r\n\r\nimport { updateStoreState, clearStoreDep, removeStoreDep } from \"./dep\";\r\n\r\nimport { getCurrentPagePath } from \"./utils\";\r\n\r\nfunction callUseStoreRef(\r\n  instance: Instance,\r\n  stores?: BaseStoreOptions | StoreOptions\r\n) {\r\n  stores?.forEach((s) => {\r\n    const { useStoreRef, ...rest } = s;\r\n    useStoreRef(instance, rest);\r\n  });\r\n}\r\n\r\nexport function proxyApp() {\r\n  setTip(\"isProxyApp\");\r\n\r\n  const originApp = App;\r\n\r\n  App = function (options: AppNewOptions) {\r\n    const { stores, ...rest } = options;\r\n    const newOptions = {\r\n      ...rest,\r\n      onLaunch(o: WechatMiniprogram.App.LaunchShowOption) {\r\n        this.type = \"app\";\r\n        const { stores } = options;\r\n        callUseStoreRef(this as any as Instance, stores);\r\n\r\n        options?.onLaunch?.call(this, o);\r\n      },\r\n    } as AppOptions;\r\n\r\n    return originApp(newOptions);\r\n  };\r\n}\r\n\r\nexport function proxyPage(globalOptions: PageOptions = {}) {\r\n  setTip(\"isProxyPage\");\r\n\r\n  const OriginPage = Page;\r\n  Page = function (options: PageNewOptions) {\r\n    const { stores, ...rest } = options;\r\n    let newOptions: PageOptions = {\r\n      ...globalOptions,\r\n      ...rest,\r\n      onLoad(o) {\r\n        const { stores } = options;\r\n        callUseStoreRef(this as any as Instance, stores);\r\n\r\n        globalOptions?.onLoad?.call(this, o);\r\n        options?.onLoad?.call(this, o);\r\n      },\r\n      onShow() {\r\n        updateStoreState();\r\n\r\n        globalOptions?.onShow?.call(this);\r\n        options?.onShow?.call(this);\r\n      },\r\n      onUnload() {\r\n        clearStoreDep();\r\n        globalOptions?.onUnload?.call(this);\r\n        options?.onUnload?.call(this);\r\n      },\r\n    };\r\n\r\n    const hooks = [\r\n      \"onReady\",\r\n      \"onHide\",\r\n      \"onPullDownRefresh\",\r\n      \"onReachBottom\",\r\n      \"onPageScroll\",\r\n      \"onResize\",\r\n      \"onTabItemTap\",\r\n    ];\r\n    newOptions = mixinHooks(hooks, newOptions, globalOptions, options);\r\n\r\n    return OriginPage(newOptions);\r\n  };\r\n}\r\n\r\nexport function proxyComponent(globalOptions: ComponentOptions = {}) {\r\n  setTip(\"isProxyComponent\");\r\n\r\n  const OriginComponent = Component;\r\n  Component = function (options: ComponentNewOptions) {\r\n    const { stores, ...rest } = options;\r\n\r\n    let newOptions: ComponentOptions = {\r\n      ...globalOptions,\r\n      ...rest,\r\n      attached() {\r\n        this.route = getCurrentPagePath();\r\n        const { stores } = options;\r\n        callUseStoreRef(this as any as Instance, stores);\r\n\r\n        updateStoreState();\r\n\r\n        options?.attached?.call(this);\r\n        globalOptions?.attached?.call(this);\r\n      },\r\n      detached() {\r\n        removeStoreDep(this as any as ComponentInstance);\r\n\r\n        options?.detached?.call(this);\r\n        globalOptions?.detached?.call(this);\r\n      },\r\n      lifetimes: {\r\n        attached() {\r\n          this.route = getCurrentPagePath();\r\n          const { stores } = options;\r\n\r\n          callUseStoreRef(this as any as Instance, stores);\r\n\r\n          updateStoreState();\r\n\r\n          options?.lifetimes?.attached?.call(this);\r\n          globalOptions?.lifetimes?.attached?.call(this);\r\n        },\r\n        detached() {\r\n          removeStoreDep(this as any as ComponentInstance);\r\n\r\n          options?.lifetimes?.detached?.call(this);\r\n          globalOptions?.lifetimes?.detached?.call(this);\r\n        },\r\n      },\r\n    };\r\n\r\n    const hooks = [\r\n      \"created\",\r\n      \"ready\",\r\n      \"moved\",\r\n      \"error\",\r\n      \"lifetimes.created\",\r\n      \"lifetimes.ready\",\r\n      \"lifetimes.moved\",\r\n      \"lifetimes.error\",\r\n      \"pageLifetimes.show\",\r\n      \"pageLifetimes.hide\",\r\n      \"pageLifetimes.resize\",\r\n    ];\r\n    newOptions = mixinHooks(hooks, newOptions, globalOptions, options);\r\n\r\n    return OriginComponent(newOptions);\r\n  };\r\n}\r\n\r\ntype BaseOptions = Record<string, any>;\r\n\r\n/** 全局混入hook */\r\nfunction mixinHooks(\r\n  hooks: string[],\r\n  newOptions: BaseOptions,\r\n  globalOptions: BaseOptions,\r\n  options: BaseOptions\r\n) {\r\n  const newO = deepClone(newOptions);\r\n\r\n  hooks.forEach((name) => {\r\n    // 这里分割的原因是要注入 lifetimes.created 这种 hook\r\n    const paths = name.split(\".\");\r\n    const len = paths.length;\r\n\r\n    const indexOne = paths[0];\r\n    if (len === 1) {\r\n      newO[indexOne] = function () {\r\n        globalOptions?.[indexOne]?.call(this, ...Array.from(arguments));\r\n        options?.[indexOne]?.call(this, ...Array.from(arguments));\r\n      };\r\n    } else {\r\n      const indexTwo = paths[1];\r\n      // pageLifetimes 的生命周期会覆盖this上的生命周期\r\n      if (\r\n        globalOptions?.[indexOne]?.[indexTwo] ||\r\n        options?.[indexOne]?.[indexTwo]\r\n      ) {\r\n        newO[indexOne][indexTwo] = function () {\r\n          globalOptions?.[indexOne]?.[indexTwo]?.call(this, ...Array.from(arguments));\r\n          options?.[indexOne]?.[indexTwo]?.call(this, ...Array.from(arguments));\r\n        };\r\n      }\r\n    }\r\n  });\r\n\r\n  return newO;\r\n}\r\n","import {\r\n  isObject,\r\n  deepClone,\r\n  hasChanged,\r\n} from \"@savage181855/utils\";\r\n\r\nimport type {\r\n  StateType,\r\n  Callback,\r\n  Options,\r\n} from \"./types\";\r\n\r\nimport { Dep, updateStoreState } from \"./dep\";\r\n\r\n// not pure function\r\nfunction createReactive<T extends object>(target: T): T {\r\n  const deps = new Dep();\r\n\r\n  const obj = new Proxy(target, {\r\n    get(target, key: string, receiver) {\r\n      const res = Reflect.get(target, key, receiver);\r\n      if (Dep.stack.length > 0) {\r\n        if (!deps.get(key)) deps.set(key, new Set<Callback>());\r\n\r\n        Dep.stack.forEach((item) => {\r\n          deps.get(key)?.add(item);\r\n        });\r\n      }\r\n      return res;\r\n    },\r\n    set(target, key: string, value, receiver) {\r\n      const oldV = deepClone((target as any)[key]);\r\n      const res = Reflect.set(target, key, value, receiver);\r\n      if (hasChanged(oldV, value)) {\r\n        deps.get(key)?.forEach((item) => item(oldV, value));\r\n      }\r\n      updateStoreState();\r\n      return res;\r\n    },\r\n  });\r\n\r\n  for (let k in obj) {\r\n    const child = obj[k];\r\n    if (isObject(child)) {\r\n      obj[k] = createReactive(obj[k] as any) as any;\r\n    }\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\n// not pure function\r\nfunction setupActions(plainStore: StateType, proxyStore: StateType) {\r\n  for (let k in plainStore) {\r\n    if (typeof plainStore[k] === \"function\") {\r\n      plainStore[k] = (plainStore[k] as Function).bind(proxyStore, proxyStore);\r\n    }\r\n  }\r\n}\r\n\r\n// not pure function\r\nfunction setupPatchOfStore(plainStore: StateType, proxyStore: StateType) {\r\n  plainStore.patch = function (val: StateType | Callback) {\r\n    if (typeof val === \"object\") {\r\n      for (let k in val) {\r\n        proxyStore[k] = (val as any)[k];\r\n      }\r\n    }\r\n\r\n    if (typeof val === \"function\") {\r\n      val(proxyStore);\r\n    }\r\n  };\r\n}\r\n\r\n// not pure function\r\nfunction setupComputed(fns: Record<string, Callback>, proxyStore: StateType) {\r\n  if (fns) {\r\n    for (let k in fns) {\r\n      fns[k] = fns[k].bind(proxyStore, proxyStore);\r\n      Dep.stack.push(() => ((proxyStore as any)[k] = fns[k]()));\r\n      (proxyStore as any)[k] = fns[k]();\r\n      Dep.stack.pop();\r\n    }\r\n  }\r\n}\r\n\r\nexport function createStore<\r\n  S extends StateType,\r\n  A extends Record<string, Callback>,\r\n  C = {}\r\n>(options: Options<S, A, C>) {\r\n  const plainStore = {\r\n    ...options.state,\r\n    ...options.actions,\r\n    ...options.computed,\r\n  };\r\n\r\n  const store = createReactive(plainStore);\r\n  setupActions(plainStore, store);\r\n  setupPatchOfStore(plainStore, store);\r\n  setupComputed(options.computed as any, store);\r\n\r\n  return store;\r\n}\r\n","import {\r\n  deepClone,\r\n} from \"@savage181855/utils\";\r\n\r\nimport type {\r\n  BaseStoreOptionItem,\r\n  StateType,\r\n  Callback,\r\n  Options,\r\n  StoreOptionItem,\r\n  Instance,\r\n  PageInstance,\r\n  ComponentInstance,\r\n} from \"./types\";\r\n\r\nimport { Dep } from \"./dep\";\r\n\r\nimport { createStore } from \"./createStore\";\r\n\r\nexport function defineStore<\r\n  S extends StateType,\r\n  A extends Record<string, Callback>,\r\n  C = {}\r\n>(options: Options<S, A, C>) {\r\n  const state = options.state;\r\n  const computed = options.computed as any as Record<string, Callback>;\r\n  const actions = options.actions as any as Record<string, Callback>;\r\n\r\n  const store = createStore(options);\r\n\r\n  return function useStore(\r\n    instance: Instance,\r\n    options: BaseStoreOptionItem | StoreOptionItem\r\n  ) {\r\n    instance[options.storeKey as keyof typeof instance] = store;\r\n    if (instance.type === \"app\") return;\r\n    // ;debugger;\r\n    const o = options as StoreOptionItem;\r\n\r\n    const stateKeys = Object.keys(state);\r\n    if (o.mapState) {\r\n      o.mapState.forEach((key) => {\r\n        if (!stateKeys.includes(key)) {\r\n          console.error(\r\n            `msg: mapState \"${key}\" not in ${o.storeKey};\\n\\n` +\r\n              `info: filePath: ${instance.is};`\r\n          );\r\n          return;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (o.watch) {\r\n      // use to compare watch whether to execute\r\n      const watchValue: StateType = {};\r\n      Object.keys(o.watch).forEach((key) => {\r\n        if (!stateKeys.includes(key)) {\r\n          console.error(\r\n            `msg: watch \"${key}\" not in ${o.storeKey};\\n\\n` +\r\n              `info: filePath: ${instance.is};`\r\n          );\r\n          return;\r\n        }\r\n        watchValue[key] = deepClone(store[key]);\r\n      });\r\n      instance.watchValue = { ...(instance.watchValue as any), ...watchValue };\r\n    }\r\n\r\n    if (o.mapComputed) {\r\n      // use to compare computed function whether to execute\r\n      const computedKeys = Object.keys(computed);\r\n      o.mapComputed.forEach((key) => {\r\n        if (!computedKeys.includes(key)) {\r\n          console.error(\r\n            `msg: mapComputed \"${key}\" not in ${o.storeKey};\\n\\n` +\r\n              `info: filePath: ${instance.is};`\r\n          );\r\n          return;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (o.mapActions) {\r\n      // use to compare computed function whether to execute\r\n      const actionKeys = Object.keys(actions);\r\n      o.mapActions.forEach((key) => {\r\n        if (!actionKeys.includes(key)) {\r\n          console.error(\r\n            `msg: mapActions \"${key}\" not in ${o.storeKey};\\n\\n` +\r\n              `info: filePath: ${instance.is};`\r\n          );\r\n          return;\r\n        }\r\n        instance[key] = store[key];\r\n      });\r\n    }\r\n\r\n    const route = instance.route as keyof typeof instance as string;\r\n\r\n    Dep.stores[route] = Dep.stores[route] || [];\r\n\r\n    const isExist = Dep.stores[route].some((v) => {\r\n      return v.instance === instance && v.store === store;\r\n    });\r\n\r\n    if (!isExist) {\r\n      Dep.stores[route].push({\r\n        ...o,\r\n        instance: instance as PageInstance | ComponentInstance,\r\n        store,\r\n      });\r\n    }\r\n  };\r\n}\r\n"],"names":["compare","o1","o2","type","Object","keys","length","_i","_a","key","result","isSameDeep","dataType","clone","o","objType","prototype","toString","call","getType","obj_1","forEach","k","map","item","deepClone_1","obj","hasChanged_1","value","oldValue","isObject_1","isSameDeep_1","setTip","setTimeout","tip","text","console","error","types","isProxyPage","isProxyComponent","isProxyApp","getCurrentPagePath","pages","getCurrentPages","route","Dep","Map","updateStoreState","path","stores","s","mapState","instance","store","watch","mapComputed","stateArr","push","data","deepClone","JSON","stringify","setData","watchValue","newValue","bind","removeStoreDep","filter","callUseStoreRef","useStoreRef","rest","__rest","proxyApp","originApp","App","options","newOptions","assign","onLaunch","this","proxyPage","globalOptions","OriginPage","Page","onLoad","_b","onShow","onUnload","clearStoreDep","mixinHooks","proxyComponent","OriginComponent","Component","attached","detached","lifetimes","_d","_c","hooks","newO","name","paths","split","len","indexOne","Array","from","arguments","indexTwo","createReactive","target","deps","Proxy","get","receiver","res","Reflect","stack","set","Set","add","oldV","hasChanged","child","isObject","createStore","plainStore","state","actions","computed","proxyStore","setupActions","patch","val","setupPatchOfStore","fns","pop","setupComputed","defineStore","storeKey","stateKeys","includes","is","computedKeys","mapActions","actionKeys","some","v"],"mappings":"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"}